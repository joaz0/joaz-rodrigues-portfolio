<div class="quote-calculator-overlay" [class.active]="isOpen" (click)="closeCalculator()">
  <div class="quote-calculator-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Calculadora de Orçamento</h2>
      <button class="close-btn" (click)="closeCalculator()" aria-label="Fechar">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      <div class="step-indicators">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">1</div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">2</div>
        <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">3</div>
        <div class="step" [class.active]="currentStep >= 4" [class.completed]="currentStep > 4">4</div>
      </div>
    </div>

    <div class="modal-content">
      <!-- Step 1: Project Type -->
      <div class="step-content" *ngIf="currentStep === 1">
        <h3>Que tipo de projeto você precisa?</h3>
        <div class="options-grid">
          <div class="option-card" 
               *ngFor="let type of projectTypes"
               [class.selected]="projectType === type.id"
               (click)="projectType = type.id">
            <div class="option-header">
              <h4>{{ type.name }}</h4>
              <span class="price">A partir de R$ {{ type.basePrice | number:'1.0-0' }}</span>
            </div>
            <ul class="features-list">
              <li *ngFor="let feature of type.features">
                <i class="fas fa-check"></i>
                {{ feature }}
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Step 2: Complexity -->
      <div class="step-content" *ngIf="currentStep === 2">
        <h3>Qual a complexidade do seu projeto?</h3>
        <div class="complexity-options">
          <div class="complexity-card"
               *ngFor="let comp of complexityOptions"
               [class.selected]="complexity === comp.id"
               (click)="complexity = comp.id">
            <h4>{{ comp.name }}</h4>
            <div class="multiplier">{{ comp.multiplier }}x</div>
            <p *ngIf="comp.id === 'simple'">Funcionalidades básicas, design padrão</p>
            <p *ngIf="comp.id === 'medium'">Funcionalidades customizadas, integrações</p>
            <p *ngIf="comp.id === 'complex'">Arquitetura avançada, múltiplas integrações</p>
          </div>
        </div>

        <div class="additional-features">
          <h4>Funcionalidades Adicionais</h4>
          <div class="features-grid">
            <div class="feature-item"
                 *ngFor="let feature of additionalFeatures"
                 [class.selected]="features.includes(feature.id)"
                 (click)="toggleFeature(feature.id)">
              <span class="feature-name">{{ feature.name }}</span>
              <span class="feature-price">+R$ {{ feature.price | number:'1.0-0' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Timeline & Budget -->
      <div class="step-content" *ngIf="currentStep === 3">
        <h3>Prazo e Orçamento</h3>
        <div class="form-group">
          <label>Prazo desejado</label>
          <select [(ngModel)]="timeline" class="form-control">
            <option value="">Selecione o prazo</option>
            <option value="urgent">Urgente (2-4 semanas)</option>
            <option value="normal">Normal (1-2 meses)</option>
            <option value="flexible">Flexível (2-3 meses)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Orçamento disponível</label>
          <select [(ngModel)]="budget" class="form-control">
            <option value="">Selecione o orçamento</option>
            <option value="5k">Até R$ 5.000</option>
            <option value="10k">R$ 5.000 - R$ 10.000</option>
            <option value="20k">R$ 10.000 - R$ 20.000</option>
            <option value="50k">R$ 20.000 - R$ 50.000</option>
            <option value="50k+">Acima de R$ 50.000</option>
          </select>
        </div>

        <div class="quote-preview" *ngIf="projectType && complexity">
          <h4>Estimativa Preliminar</h4>
          <div class="estimate-card">
            <div class="estimate-item">
              <span>Valor Total:</span>
              <strong>R$ {{ calculateQuote().total | number:'1.0-0' }}</strong>
            </div>
            <div class="estimate-item">
              <span>Prazo:</span>
              <strong>{{ calculateQuote().timeline }}</strong>
            </div>
            <div class="estimate-item">
              <span>ROI Estimado:</span>
              <strong>R$ {{ calculateQuote().roi | number:'1.0-0' }}</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4: Contact Info -->
      <div class="step-content" *ngIf="currentStep === 4">
        <h3>Seus dados para contato</h3>
        <div class="contact-form">
          <div class="form-row">
            <div class="form-group">
              <label>Nome completo *</label>
              <input type="text" [(ngModel)]="name" class="form-control" placeholder="Seu nome">
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input type="email" [(ngModel)]="email" class="form-control" placeholder="seu@email.com">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Telefone</label>
              <input type="tel" [(ngModel)]="phone" class="form-control" placeholder="(00) 00000-0000">
            </div>
            <div class="form-group">
              <label>Empresa</label>
              <input type="text" [(ngModel)]="company" class="form-control" placeholder="Nome da empresa">
            </div>
          </div>
        </div>

        <div class="final-quote" *ngIf="projectType && complexity">
          <h4>Resumo do Orçamento</h4>
          <div class="quote-summary">
            <div class="summary-item">
              <span>Projeto:</span>
              <strong>{{ projectTypes.find(p => p.id === projectType)?.name }}</strong>
            </div>
            <div class="summary-item">
              <span>Complexidade:</span>
              <strong>{{ complexityOptions.find(c => c.id === complexity)?.name }}</strong>
            </div>
            <div class="summary-item">
              <span>Funcionalidades:</span>
              <strong>{{ calculateQuote().features.length }} itens</strong>
            </div>
            <div class="summary-total">
              <span>Total:</span>
              <strong>R$ {{ calculateQuote().total | number:'1.0-0' }}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" 
              *ngIf="currentStep > 1" 
              (click)="prevStep()">
        <i class="fas fa-arrow-left"></i>
        Voltar
      </button>
      
      <button class="btn btn-primary" 
              *ngIf="currentStep < totalSteps" 
              [disabled]="!canProceed"
              (click)="nextStep()">
        Próximo
        <i class="fas fa-arrow-right"></i>
      </button>
      
      <button class="btn btn-primary" 
              *ngIf="currentStep === totalSteps" 
              [disabled]="!canProceed"
              (click)="submitQuote()">
        <i class="fas fa-paper-plane"></i>
        Enviar Orçamento
      </button>
    </div>
  </div>
</div>